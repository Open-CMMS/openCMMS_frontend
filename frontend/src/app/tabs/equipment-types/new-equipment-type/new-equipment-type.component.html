<div class="container-fluid col-md-5 mt-3 justify-content-center">
    <div class="d-flex flex-wrap">
      <h2 class="font-weight-bold">Create a new equipment type</h2>
    </div>

    <form [formGroup]="equipmentTypeForm" (ngSubmit)="onSubmit()" >
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" class='form-control' formControlName="name" id="name">
      </div>
      <form [formGroup]="fieldForm" (ngSubmit)="onSubmitField()">
        <div class="form-group">
          <label>Fields</label>
          <br>
          <button class="btn btn-outline-secondary" type="button" (click)="onOpenField()">
            <span class="mr-3">Create a new field</span>
            <fa-icon [icon]="faPlusSquare"></fa-icon>
          </button>
        </div>
        <div class="form-group" *ngIf='openField'>
          <div class="form-row d-flex justify-content-between">
            <button class="btn btn-danger ml-md-1 mr-md-2" (click)="onCloseField()">
              <fa-icon [icon]="faMinusCircle"></fa-icon>
            </button>
            <input
              type="text"
              placeholder="Field name"
              class='form-control col-md-4 mr-md-2 my-1'
              formControlName="fieldName"
              >
              <input
              type="text"
              placeholder="Field value"
              class='form-control col-md-5 mr-md-2 my-1'
              formControlName="fieldValue"
              data-toggle="tooltip"
              title="You can enter multiple values separated by a comma.">
            <span
              data-toggle="tooltip"
              title="Field name required">
              <button
              class="btn btn-primary mr-md-1 my-1"
              (click)="onAddField()"
              [disabled]="fieldForm.invalid"
              >
                Add
              </button>
            </span>
          </div>
        </div>
        <div class="form-group" *ngFor="let field of fieldList">
          <div class="form-row d-flex flex-wrap justify-content-between">
            <button class="btn btn-danger ml-md-1 mr-md-2"
              (click)="deleteField(field)"
            >
              <fa-icon [icon]="faMinusCircle"></fa-icon>
            </button>
            <input
              type="text"
              class="form-control col-md-4 mr-md-2 my-1"
              [(ngModel)]="field[FIELDNAME_NAME]"
              [attr.disabled]="!isEditingField(field) ? '' : null"
              [ngModelOptions]="{standalone: true}"
            >
            <input
            type="text"
            class='form-control col-md-5 mr-md-2 my-1'
            [(ngModel)]="field[FIELDVALUE_NAME]"
            [attr.disabled]="!isEditingField(field)? '' : null"
            [ngModelOptions]="{standalone: true}"
            >
            <button
              *ngIf="!isEditingField(field)"
              class="btn btn-link my-1"
              (click)="onEditField(field)"
              style="
                color:grey;
                margin-left:4px;
                margin-right:12px"
            >
              <fa-icon [icon]="faPencilAlt"></fa-icon>
            </button>
            <button
              *ngIf="isEditingField(field)"
              class="btn btn-link my-1"
              (click)="onEditField(field)"
              style="
                color:grey;
                margin-left:4px;
                margin-right:12px"
              [disabled]="isEditingFieldValid(field)"
              >
              <fa-icon [icon]="faSave"></fa-icon>
            </button>
          </div>
        </div>
      </form>
      <div class="d-flex justify-content-between align-items-center">
        <button class="btn btn-danger nav-link" routerLink="/equipment-types">Cancel</button>
        <button
          class="btn btn-primary"
          type="submit"
          title="Name required and fields should not be in edition mode"
          [disabled]="equipmentTypeForm.invalid || !addField || !(canValidateForm())"
        >
          Create Equipment Type
        </button>
      </div>
    </form>
  </div>
