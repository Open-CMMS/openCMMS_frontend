<div class="container-fluid col-10 mt-3 justify-content-center">
    <div class="d-flex">
        <h2 class="font-weight-bold">Create a new Equipment</h2>
    </div>
    <form [formGroup]="createForm" (ngSubmit)="onCreateEquipment()">
        <div class="form-group">
            <label for="name">Equipment Name </label>
            <input type="text" id="name" class="form-control" formControlName="name">
        </div>
        <div class="form-group">
            <label for="teamType">Equipment Type </label>
            <select id="teamType" class="form-control" formControlName="equipmentType" (change)="initEquipmentTypeFields($event.target.value)">
                    <option *ngFor="let equipmentType of equipmentTypes" [value]="equipmentType.id">{{ equipmentType.name }}</option>
            </select>
        </div>
    <div class="form-group ">
      <label>Fields</label>
    </div>
      <div class="list-group-item" *ngFor="let field of equipmentTypeFields; let i = index" (change)="modifyEquipmentTypeFieldValue($event.target, i)">
        <div class="input-group-append form-group" style="margin-bottom: 10px">
              <p style="width: 270px">
                <span
                  class="col-4 mr-2"
                >
                  {{ field.name }}
                </span>
              </p>
              <input
                id="field-value-text"
                type="text" placeholder="value"
                class='form-control col-4 mr-2'
                *ngIf="field.value.length === 0"
              >
              <select
                id="field-value-select"
                class="form-control col-4 mr-2"
                *ngIf="field.value.length !== 0"
              >
                <option disabled selected value> -- select an option -- </option>
                <option *ngFor="let fieldValue of field.value" [value]="fieldValue">{{ fieldValue }}</option>
              </select>
          <input
            id="field-description"
            type="text"
            placeholder="description"
            class='form-control col-5'
          >
        </div>
      </div>
      <br/>

      <form [formGroup]="addFieldForm" (ngSubmit)="onSubmitField()">
        <div class="form-group">
          <button type="button" class="btn btn-outline-secondary" (click)="onOpenField()">
            <span class="mr-3">Create a new field</span>
            <fa-icon [icon]="faPlusSquare"></fa-icon>
          </button>
        </div>
        <div class="class form-group" *ngIf="openField">
          <div class="form-row">
            <button class="btn btn-danger ml-1 mr-2" (click)="onCloseField()">
              <fa-icon [icon]="faMinusCircle"></fa-icon>
            </button>
            <input
              type="text"
              placeholder="Field name"
              class="form-control col-3 mr-2"
              formControlName="name"
            >
            <input
              type="text"
              placeholder="Field value"
              class="form-control col-3 mr-2"
              formControlName="value"
            >
            <input
              type="text"
              placeholder="Field description"
              class="form-control col-4 mr-2"
              formControlName="description"
            >
            <span
              data-toggle="tooltip"
              title="Field name and value required">
              <button
                class="btn btn-primary mr-1"
                (click)="onAddField()"
                [disabled]="addFieldForm.invalid"
              >
                Add
              </button>
            </span>
          </div>
        </div>

      </form>
      <div class="form-group" *ngFor="let field of fields; let i = index">
        <div class="form-row">
          <button class="btn btn-danger ml-1 mr-2" type="button" (click)="deleteField(i)" >
            <fa-icon [icon]="faMinusCircle"></fa-icon>
          </button>
            <input
              type="text"
              placeholder="Field name"
              class="form-control col-3 mr-2"
              [ngModelOptions]="{standalone: true}"
              [attr.disabled]="!isEditingField(field) ? '' : null"
              [(ngModel)]=field.name
            >
            <input
              type="text"
              placeholder="Field value"
              class="form-control col-3 mr-2"
              [ngModelOptions]="{standalone: true}"
              [attr.disabled]="!isEditingField(field) ? '' : null"
              [(ngModel)]=field.value
            >

            <input
              type="text"
              placeholder="Field description"
              class="form-control col-3 mr-4"
              [ngModelOptions]="{standalone: true}"
              [attr.disabled]="!isEditingField(field) ? '' : null"
              [(ngModel)]=field.description
            >
          <button
            *ngIf="!isEditingField(field)"
            class="btn btn-link"
            (click)="onEditField(field)"
            style="
                color:grey;
                margin-left:4px;
                margin-right:12px"
          >
            <fa-icon [icon]="faPencilAlt"></fa-icon>
          </button>
          <button
            *ngIf="isEditingField(field)"
            class="btn btn-link"
            (click)="onEditField(field)"
            style="
                color:grey;
                margin-left:4px;
                margin-right:12px"
            [disabled]="isEditingFieldValid(field)"
          >
            <fa-icon [icon]="faSave"></fa-icon>
          </button>
        </div>
      </div>
        <div class="form-group">
            <label for="file">Upload File</label>
            <input formControlName="file" id="file" type="file" multiple class="form-control" (change)="onFileUpload($event)">
        </div>
        <div class="list-group">
            <ul class="list-group">
                <li
                    class="container-fluid list-group-item font-weight-bold "
                    *ngFor="let file of myFiles;"
                    >
                    <div class="container-fluid row justify-content-between">
                        <h5 style="margin-bottom: 0px; vertical-align: middle;">{{ file.name }}</h5>
                        <button class="btn btn-danger" (click)="onRemoveFile(file)"><fa-icon [icon]="faMinusSquare" size="2x"></fa-icon></button>
                    </div>
                </li>
            </ul>
        </div>
        <div class="d-flex justify-content-between align-items-center">
          <button class="btn btn-danger nav-link" routerLink="/equipments">Cancel</button>
          <button
            type="submit"
            class="btn btn-primary"
            title="Name, Equipment Type and Fields value required"
            [disabled]="createForm.invalid || missingEquipmentTypeFieldsValue() || !addField || !(canValidateForm())"
          >
            Create Equipment
          </button>
        </div>
    </form>
</div>
